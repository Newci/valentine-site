<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ë—É–¥–µ—à—å –º–æ–∏–º –í–∞–ª–µ–Ω—Ç–∏–Ω–æ–º? üíò</title>

  <style>
    :root{
      --bg1:#fff0f6;
      --bg2:#ffe4ef;
      --card:#ffffffcc;
      --text:#2b2b2b;
      --yes:#ff2d55;
      --no:#ffffff;
      --noText:#2b2b2b;
      --shadow: 0 16px 40px rgba(0,0,0,.12);
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(900px 500px at 20% 10%, var(--bg2), transparent 60%),
                  radial-gradient(900px 500px at 80% 90%, #ffd6e7, transparent 60%),
                  linear-gradient(135deg, var(--bg1), #fff);
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    /* ===== –§–æ–Ω–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã ===== */
    .bg-phrases{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
      opacity: 0.95;
    }

    .bg-phrase{
      position: absolute;
      left: var(--x);
      top: var(--y);

      color: rgba(0,0,0,0.36);
      text-shadow: 0 2px 6px rgba(0,0,0,.14);

      white-space: normal;
      max-width: min(38vw, 520px);
      line-height: 1.25;
      text-align: center;

      font-size: var(--size);
      transform: translate(-50%, -50%) rotate(var(--rot));
      opacity: 0;
      will-change: transform, opacity;

      /* –í–ê–ñ–ù–û: –±–µ–∑ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —Å–¥–≤–∏–≥–∞ –≤–Ω–∏–∑ */
      animation: floatFadeUp var(--dur) linear forwards;
    }

    /* –°—Ç–∞—Ä—Ç —Ä–æ–≤–Ω–æ –≤ –º–µ—Å—Ç–µ –ø–æ—è–≤–ª–µ–Ω–∏—è -> –ø–ª–∞–≤–Ω–æ –≤–≤–µ—Ä—Ö */
    @keyframes floatFadeUp{
      0%{
        opacity: 0;
        transform: translate(-50%, -50%) rotate(var(--rot));
      }
      12%{
        opacity: 1;
        transform: translate(-50%, -50%) rotate(var(--rot));
      }
      88%{
        opacity: 1;
        transform: translate(-50%, calc(-50% - 220px)) rotate(var(--rot));
      }
      100%{
        opacity: 0;
        transform: translate(-50%, calc(-50% - 280px)) rotate(var(--rot));
      }
    }

    /* –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–≤–µ—Ä—Ö —Ñ–æ–Ω–∞ */
    .card{
      width:min(820px, 100%);
      background:var(--card);
      backdrop-filter: blur(8px);
      border-radius:24px;
      box-shadow:var(--shadow);
      padding: 26px;
      display:grid;
      gap:18px;
      text-align:center;
      border: 1px solid rgba(255,255,255,.6);
      position: relative;
      z-index: 1;
    }

    h1{
      margin: 6px 0 0;
      font-size: clamp(22px, 4vw, 34px);
      line-height: 1.1;
    }
    p{
      margin: 0;
      opacity: .9;
      font-size: 16px;
    }

    .imgwrap{
      display:flex;
      justify-content:center;
      align-items:center;
    }
    img.hero{
      width:min(360px, 100%);
      border-radius: 18px;
      box-shadow: 0 10px 26px rgba(0,0,0,.10);
      user-select:none;
      -webkit-user-drag:none;
    }

    /* ===== –ö–Ω–æ–ø–∫–∏ ===== */
    .btnstage{
      position: relative;
      height: 92px;
      display:flex;
      justify-content:center;
      align-items:center;
      margin-top: 6px;
    }
    .btnrow{
      position: relative;
      width: min(520px, 100%);
      height: 92px;
    }

    button{
      border: none;
      border-radius: 999px;
      padding: 14px 22px;
      font-size: 18px;
      cursor: pointer;
      transition: transform .22s ease, box-shadow .22s ease, background .15s ease;
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      min-width: 140px;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      will-change: transform;
    }
    button:active{ transform: translateY(calc(-50% + 1px)) scale(0.99); }

    #yesBtn{
      background: var(--yes);
      color: white;
      left: 50%;
      transform: translate(-50%, -50%) scale(1) translateX(0px);
      z-index: 2;
    }

    #noBtn{
      background: var(--no);
      color: var(--noText);
      border: 1px solid rgba(0,0,0,.12);
      left: 50%;
      transform: translate(-50%, -50%) translateX(170px);
      z-index: 1;
    }

    .heart{
      display:inline-block;
      animation: pulse 1.2s infinite ease-in-out;
      transform-origin:center;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.15); }
    }
  </style>
</head>

<body>
  <div class="bg-phrases" id="bgPhrases"></div>

  <main class="card" id="card">
    <h1>–ë—É–¥–µ—à—å –º–æ–∏–º –í–∞–ª–µ–Ω—Ç–∏–Ω–æ–º? <span class="heart">üíò</span></h1>
    <p>–Ø –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª –∫–æ–µ-—á—Ç–æ. –í—ã–±–∏—Ä–∞–π —á–µ—Å—Ç–Ω–æ</p>

    <div class="imgwrap">
      <img class="hero" src="assets/valentine.png" alt="Valentine image">
    </div>

    <div class="btnstage">
      <div class="btnrow">
        <button id="yesBtn">–î–∞ üíñ</button>
        <button id="noBtn">–ù–µ—Ç</button>
      </div>
    </div>
  </main>

  <script>
    // === –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò ===
    const MAX_NO_CLICKS = 20;
    const YES_GROW_STEP = 0.08;
    const YES_MAX_SCALE = 2.6;

    // –§–æ–Ω: —Ä–µ–∂–µ
    const SPAWN_EVERY_MS = 2600;
    const INITIAL_COUNT  = 4;
    const MAX_ON_SCREEN  = 9;

    // –ö–æ—Ä–∏–¥–æ—Ä –¥–≤–∏–∂–µ–Ω–∏—è –≤–≤–µ—Ä—Ö (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å >= —á–µ–º –≤ @keyframes)
    const TRAVEL_UP_PX = 320;

    // –û—Ç—Å—Ç—É–ø—ã
    const EDGE_MARGIN = 90; // –º–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –¥–æ 60, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –±–ª–∏–∂–µ –∫ –∫—Ä–∞—è–º
    const CARD_PAD = 55;
    const LONG_LEN = 42;

    // –ù–∞—Å–∫–æ–ª—å–∫–æ –±–ª–∏–∑–∫–æ –∫ —Å–∞–º–æ–º—É –Ω–∏–∑—É —Å—Ç–∞—Ä—Ç—É–µ–º (–º–µ–Ω—å—à–µ = –Ω–∏–∂–µ)
    const BOTTOM_BAND_HEIGHT = 30; // <-- —Ñ—Ä–∞–∑—ã —Å—Ç–∞—Ä—Ç—É—é—Ç –≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 30px (–∫—Ä–æ–º–µ EDGE_MARGIN)

    // –ö–Ω–æ–ø–∫–∞ "–ù–µ—Ç" ‚Äî —Ç–≤–æ–∏ —Ñ—Ä–∞–∑—ã
    const noPhrases = [
      "—è —Ç–µ–±—è –ª—é–±–ª—é",
      "–Ω—É –ø–æ–∂–∞–ª—É–π—Å—Ç–∞",
      "–º–Ω–µ —ç—Ç–æ –≤–∞–∂–Ω–æ",
      "–¥–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º?",
      "—Ç—ã —Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω–∞?",
      "–Ω–µ –¥–µ–ª–∞–π –º–Ω–µ –±–æ–ª—å–Ω–æ",
      "—è —Å—Ç–∞—Ä–∞–ª—Å—è",
      "–Ω—É —Ö–æ—Ç—å —á—É—Ç—å-—á—É—Ç—å",
      "–æ–±–µ—â–∞—é –±—ã—Ç—å –ª—É—á—à–∏–º",
      "—Å —Ç–æ–±–æ–π –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ",
      "—è —Ü–µ–Ω—é —Ç–µ–±—è",
      "—Ç—ã –º–Ω–µ –¥–æ—Ä–æ–≥–∞",
      "–¥–∞–π —à–∞–Ω—Å!",
      "—ç—Ç–æ —Å—É–¥—å–±–∞",
      "–ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏ ¬´–î–∞¬ª",
      "—è —É–ª—ã–±–∞—é—Å—å, –∫–æ–≥–¥–∞ —Ç—ã –ø–∏—à–µ—à—å",
      "—Ç—ã –æ—Å–æ–±–µ–Ω–Ω–∞—è",
      "—è –æ—á–µ–Ω—å —Ö–æ—á—É",
      "–ª–∞–¥–Ω–æ‚Ä¶ –Ω–æ —è –Ω–µ —Å–¥–∞—é—Å—å",
      "–Ω—É –≤—Å—ë, —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑"
    ];

    // –§–æ–Ω–æ–≤—ã–µ —Ü–∏—Ç–∞—Ç—ã ‚Äî —Ç–≤–æ–∏
    const loveBgPhrases = [
      "–ª—é–±–ª—é —Ç–µ–±—è",
      "—Ç—ã –º–æ—ë —Å—á–∞—Å—Ç—å–µ",
      "–æ–±–Ω–∏–º–∞—é",
      "—Ç—ã –æ—á–µ–Ω—å –º–Ω–µ –≤–∞–∂–Ω–∞",
      "—Ç—ã - –º–æ—è –ø–µ—Ä–≤–∞—è –º—ã—Å–ª—å, –∫–æ–≥–¥–∞ —è –ø—Ä–æ—Å—ã–ø–∞—é—Å—å",
      "–±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–µ–±–µ —è —á—É–≤—Å–≤—É—é —Å–µ–±—è –ª—É—á—à–µ",
      "—Ç–≤–æ—è –Ω–µ–∂–Ω–æ—Å—Ç—å –¥–µ–ª–∞–µ—Ç –º–æ—é –∂–∏–∑–Ω—å –ª—É—á—à–µ",
      "—è —Ö–æ—á—É –≤—Å—ë —Ç–≤–æ–µ —Ç–µ–ø–ª–æ",
      "–¥–∞–≤–∞–π –ø—Ä–æ–∂–∏–≤–µ–º –≤—Å—é –∂–∏–∑–Ω—å –≤–º–µ—Å—Ç–µ",
      "–ø—Å–∏—Ö–æ–ª–æ–≥–∏ –≤—Ä—É—Ç, –∫–æ–≥–¥–∞ –≥–æ–≤–æ—Ä—è—Ç, —á—Ç–æ –ª—é–±–æ–≤—å –∂–∏–≤–µ—Ç —Ç—Ä–∏ –≥–æ–¥–∞. —è –±—É–¥—É –ª—é–±–∏—Ç—å —Ç–µ–±—è —Ü–µ–ª—É—é –≤–µ—á–Ω–æ—Å—Ç—å!"
    ];

    const bg = document.getElementById('bgPhrases');
    const card = document.getElementById('card');

    function rand(min, max){ return Math.random() * (max - min) + min; }
    function pick(arr){ return arr[Math.floor(Math.random() * arr.length)]; }

    function rectsOverlap(a, b, pad = 10) {
      return !(
        a.right  < b.left  - pad ||
        a.left   > b.right + pad ||
        a.bottom < b.top   - pad ||
        a.top    > b.bottom+ pad
      );
    }

    function motionRect(now){
      return {
        left: now.left,
        right: now.right,
        top: now.top - TRAVEL_UP_PX,
        bottom: now.bottom + 10
      };
    }

    function safeCardRect(){
      const r = card.getBoundingClientRect();
      return {
        left: r.left - CARD_PAD,
        right: r.right + CARD_PAD,
        top: r.top - CARD_PAD,
        bottom: r.bottom + CARD_PAD
      };
    }

    function bottomYMin(){
      return window.innerHeight - EDGE_MARGIN - BOTTOM_BAND_HEIGHT;
    }
    function bottomYMax(){
      return window.innerHeight - EDGE_MARGIN;
    }

    function buildZones(isLong){
      const r = card.getBoundingClientRect();
      const vw = window.innerWidth;

      const leftAreaRight = Math.max(EDGE_MARGIN, r.left - CARD_PAD);
      const rightAreaLeft = Math.min(vw - EDGE_MARGIN, r.right + CARD_PAD);

      const zones = [];

      // –í–°–ï–ì–î–ê –µ—Å—Ç—å –Ω–∏–∂–Ω—è—è —à–∏—Ä–æ–∫–∞—è –∑–æ–Ω–∞ (–¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–Ω–∏–∑—É)
      zones.push({
        name: "bottomWide",
        xMin: EDGE_MARGIN,
        xMax: vw - EDGE_MARGIN,
        yMin: bottomYMin(),
        yMax: bottomYMax()
      });

      if (isLong) return zones;

      // –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç –±–æ–∫–æ–≤—ã–µ —Å–Ω–∏–∑—É
      if (leftAreaRight - EDGE_MARGIN > 80) {
        zones.unshift({
          name: "bottomLeft",
          xMin: EDGE_MARGIN,
          xMax: leftAreaRight,
          yMin: bottomYMin(),
          yMax: bottomYMax()
        });
      }
      if ((vw - EDGE_MARGIN) - rightAreaLeft > 80) {
        zones.unshift({
          name: "bottomRight",
          xMin: rightAreaLeft,
          xMax: vw - EDGE_MARGIN,
          yMin: bottomYMin(),
          yMax: bottomYMax()
        });
      }

      return zones;
    }

    function spawnOne(){
      if (!bg || !card) return;
      if (bg.querySelectorAll('.bg-phrase').length >= MAX_ON_SCREEN) return;

      const text = pick(loveBgPhrases);
      const isLong = text.length >= LONG_LEN;
      const zones = buildZones(isLong);
      const cardSafe = safeCardRect();

      for (let attempt = 0; attempt < 30; attempt++){
        const z = zones[Math.min(attempt, zones.length - 1)];

        const el = document.createElement('div');
        el.className = 'bg-phrase';
        el.textContent = text;

        const size = (isLong ? rand(13, 18) : rand(14, 22)).toFixed(1) + "px";
        const rot  = rand(-10, 10).toFixed(1) + "deg";
        const dur  = rand(14, 20).toFixed(1) + "s";

        const x = rand(z.xMin, z.xMax);
        const y = rand(z.yMin, z.yMax); // –ø—Ä—è–º–æ –≤ –Ω–∏–∂–Ω–µ–π –ø–æ–ª–æ—Å–µ

        el.style.setProperty('--x', x + 'px');
        el.style.setProperty('--y', y + 'px');
        el.style.setProperty('--size', size);
        el.style.setProperty('--rot', rot);
        el.style.setProperty('--dur', dur);

        bg.appendChild(el);

        const now = el.getBoundingClientRect();
        const path = motionRect(now);

        // 1) —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É
        if (rectsOverlap(path, cardSafe, 0)) { el.remove(); continue; }

        // 2) –æ—Ç—Å—Ç—É–ø –æ—Ç –∫—Ä–∞—ë–≤
        if (
          now.left < EDGE_MARGIN - 6 ||
          now.right > window.innerWidth - EDGE_MARGIN + 6 ||
          now.top < EDGE_MARGIN - 6 ||
          now.bottom > window.innerHeight - EDGE_MARGIN + 6
        ) { el.remove(); continue; }

        // 3) –Ω–µ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—Ç—å—Å—è
        let overlaps = false;
        const others = bg.querySelectorAll('.bg-phrase');
        for (const other of others){
          if (other === el) continue;
          const o = other.getBoundingClientRect();
          if (rectsOverlap(now, o, 18)) { overlaps = true; break; }
        }
        if (overlaps) { el.remove(); continue; }

        el.addEventListener('animationend', () => el.remove(), { once: true });
        return;
      }
    }

    for (let i = 0; i < INITIAL_COUNT; i++) spawnOne();
    setInterval(spawnOne, SPAWN_EVERY_MS);

    // === –ö–ù–û–ü–ö–ò ===
    const yesBtn = document.getElementById('yesBtn');
    const noBtn  = document.getElementById('noBtn');

    let noClicks = 0;
    let yesScale = 1;

    function setNoButtonText() {
      const phrase = noPhrases[(noClicks - 1) % noPhrases.length];
      noBtn.textContent = phrase.charAt(0).toUpperCase() + phrase.slice(1);
    }

    function updateButtonsLayout() {
      const noShift  = Math.min(290, 170 + noClicks * 12);
      const yesShift = -Math.min(170, noClicks * 7);

      yesBtn.style.transform = `translate(-50%, -50%) translateX(${yesShift}px) scale(${yesScale})`;
      noBtn.style.transform  = `translate(-50%, -50%) translateX(${noShift}px)`;
    }

    function growYesButton() {
      yesScale = Math.min(YES_MAX_SCALE, yesScale + YES_GROW_STEP);
    }

    function goToYesPage() {
      window.location.href = "yes.html";
    }

    yesBtn.addEventListener('click', goToYesPage);

    noBtn.addEventListener('click', () => {
      noClicks += 1;
      setNoButtonText();
      growYesButton();
      updateButtonsLayout();
      if (noClicks >= MAX_NO_CLICKS) goToYesPage();
    });

    updateButtonsLayout();
  </script>
</body>
</html>
